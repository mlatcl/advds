---
title: "Practical Two"
venue: "Intel Lab, William Gates Building"
abstract: "<p>In this practical session we look at the second aspect of the Fynesse data science process, <em>assess</em>. In particular, we are going to download data from OpenStreetMap and verify its quality and utility.</p>"
author:
- given: Neil D.
  family: Lawrence
  url: http://inverseprobability.com
  institute: University of Cambridge
  twitter: lawrennd
  gscholar: r3SJcvoAAAAJ
  orcid: 
edit_url: https://github.com/lawrennd/talks/edit/gh-pages/_ads/practical-two.md
date: 2021-11-16
published: 2021-11-16
time: "15:00"
week: 6
ipynb: practical-two.ipynb
edit_url: https://github.com/lawrennd/talks/edit/gh-pages/_ads/practical-two.md
layout: notebook
categories:
- notes
---



<!-- Do not edit this file locally. -->
<!---->
<!-- Do not edit this file locally. -->
<!-- Do not edit this file locally. -->
<!-- The last names to be defined. Should be defined entirely in terms of macros from above-->
<!--

-->
<h2 id="revert-matplotlib-version">Revert Matplotlib Version</h2>
<p>Revert <code>matplotlib</code> version on Google Colab due to bug mentioned <a href="https://github.com/facebook/prophet/issues/1691">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip uninstall <span class="op">--</span>yes matplotlib</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install matplotlib<span class="op">==</span><span class="fl">3.1.3</span></span></code></pre></div>
<h2 id="mapping-data">Mapping Data</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span class="editsection" style=""><a href="https://github.com/lawrennd/talks/edit/gh-pages/_maps/includes/mapping-intro.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/talks/edit/gh-pages/_maps/includes/mapping-intro.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>Many of the questions we ask in data science are about how we live, who we are and how we might live better. So it is no surprise that an important source of information for data science comes from <em>mapping data</em>.</p>
<p>Questions about how best to make deliveries, where to locate facilities, national disease susceptibility, how to get to work, where to go for a walk, disaster response<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and a myriad of other applications.</p>
<p>The wider field of geospatial data analysis is also vital for monitoring our environment and human activity<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> on our globe.</p>
<p>With all of this in mind, mapping data seems an appropriate domain in which to explore how we can assess a data set for use in a particular data science domain.</p>
<p>In this practical session, you will learn how to download data from OpenStreetMap, in particular we will focus on <em>points of interest</em> in OpenStreetMap. We will explore the utility of points of interest as a way of adding features into our models. We will introduce the notion of a basis function. In spatial data the basis functions we use will become features on the landscape.</p>
<h2 id="accessing-open-street-map">Accessing Open Street Map</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span class="editsection" style=""><a href="https://github.com/lawrennd/talks/edit/gh-pages/_maps/includes/open-street-map.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/talks/edit/gh-pages/_maps/includes/open-street-map.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install osmnx</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> osmnx <span class="im">as</span> ox</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>We will center out download on the city of Lagos, which has the following latitude and longitude.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>place_name <span class="op">=</span> <span class="st">&quot;Lagos, Nigeria&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="fl">6.5244</span> <span class="co"># Lagos latitude</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> <span class="fl">3.3792</span> <span class="co"># Lagos longitude</span></span></code></pre></div>
<p>We’ll create a bounding box which is 0.2 degrees wide, 1 degree is around 111km (<a href="https://en.wikipedia.org/wiki/Metre">circumference of the Earth is around 40,000 km</a> and 40,000/360=111km).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>box_width <span class="op">=</span> <span class="fl">0.2</span> <span class="co"># About 22 km</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>box_height <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>north <span class="op">=</span> latitude <span class="op">+</span> box_height<span class="op">/</span><span class="dv">2</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>south <span class="op">=</span> latitude <span class="op">-</span> box_width<span class="op">/</span><span class="dv">2</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>west <span class="op">=</span> longitude <span class="op">-</span> box_width<span class="op">/</span><span class="dv">2</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>east <span class="op">=</span> longitude <span class="op">+</span> box_width<span class="op">/</span><span class="dv">2</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve POIs</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> {<span class="st">&quot;amenity&quot;</span>: <span class="va">True</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;buildings&quot;</span>: <span class="va">True</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;historic&quot;</span>: <span class="va">True</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;leisure&quot;</span>: <span class="va">True</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;shop&quot;</span>: <span class="va">True</span>, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;tourism&quot;</span>: <span class="va">True</span>}</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>pois <span class="op">=</span> ox.geometries_from_bbox(north, south, east, west, tags)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many POIs do we have?</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;There are </span><span class="sc">{number}</span><span class="st"> points of interest surrounding latitude: </span><span class="sc">{latitude}</span><span class="st">, longitude: </span><span class="sc">{longitude}</span><span class="st">&quot;</span>.<span class="bu">format</span>(number<span class="op">=</span><span class="bu">len</span>(pois), latitude<span class="op">=</span>latitude, longitude<span class="op">=</span>longitude))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>pois.info</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pois.columns.values</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">&quot;name&quot;</span>,<span class="st">&quot;addr:city&quot;</span>,<span class="st">&quot;addr:postcode&quot;</span>,<span class="st">&quot;amenity&quot;</span>,<span class="st">&quot;building&quot;</span>,<span class="st">&quot;building:name&quot;</span>,<span class="st">&quot;building:colour&quot;</span>,<span class="st">&quot;building:material&quot;</span>,<span class="st">&quot;historic&quot;</span>,<span class="st">&quot;memorial&quot;</span>,<span class="st">&quot;religion&quot;</span>,<span class="st">&quot;tourism&quot;</span>,<span class="st">&quot;emergency&quot;</span>,<span class="st">&quot;leisure&quot;</span>,<span class="st">&quot;shop&quot;</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Print only selected cols</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>pois[cols]</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get map data.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch OSM street network from the location</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> ox.graph_from_bbox(north, south, east, west)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve nodes and edges</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>nodes, edges <span class="op">=</span> ox.graph_to_gdfs(graph)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get place boundary related to the place name as a geodataframe</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>area <span class="op">=</span> ox.geocode_to_gdf(place_name)</span></code></pre></div>
<div class="figure">
<div id="lagos-pois-figure" class="figure-frame">
<object class="svgplot " data="https://mlatcl.github.io/ads/./slides/diagrams//maps/lagos-pois.svg" width="40%" style=" ">
</object>
</div>
<div id="lagos-pois-magnify" class="magnify" onclick="magnifyFigure(&#39;lagos-pois&#39;)">
<img class="img-button" src="{{ '/assets/images/Magnify_Large.svg' | relative_url }}" style="width:1.5ex">
</div>
<div id="lagos-pois-caption" class="caption-frame">
<p>Figure: Points of Interest in Lagos as identified in Open Street Map.</p>
</div>
</div>
<div class="figure">
<div id="lagos-tourist-sites-figure" class="figure-frame">
<object class="svgplot " data="https://mlatcl.github.io/ads/./slides/diagrams//maps/lagos-tourist-sites.svg" width="40%" style=" ">
</object>
</div>
<div id="lagos-tourist-sites-magnify" class="magnify" onclick="magnifyFigure(&#39;lagos-tourist-sites&#39;)">
<img class="img-button" src="{{ '/assets/images/Magnify_Large.svg' | relative_url }}" style="width:1.5ex">
</div>
<div id="lagos-tourist-sites-caption" class="caption-frame">
<p>Figure: Tourist sites identified as Points of Interest in Open Street Map from Lagos.</p>
</div>
</div>
<p>TK: Plot health centers from the NMIS data</p>
<h2 id="thanks">Thanks!</h2>
<p>For more information on these subjects and more you might want to check the following resources.</p>
<ul>
<li>twitter: <a href="https://twitter.com/lawrennd">@lawrennd</a></li>
<li>podcast: <a href="http://thetalkingmachines.com">The Talking Machines</a></li>
<li>newspaper: <a href="http://www.theguardian.com/profile/neil-lawrence">Guardian Profile Page</a></li>
<li>blog: <a href="http://inverseprobability.com/blog.html">http://inverseprobability.com</a></li>
</ul>
<h1 id="references">References</h1>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>For example the <a href="https://blog.openstreetmap.org/2010/01/14/haiti-openstreetmap-response/">OpenStreetMap response to the 2010 Haiti Earthquake</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>For example this <a href="https://www.unglobalpulse.org/project/measuring-poverty-with-machine-roof-counting/">UN Global Pulse</a> project which measures roof material as a proxy for poverty levels.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

